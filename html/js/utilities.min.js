var oTable;function convertToHours(totalTime,unit){var hours=Math.floor(totalTime/3600);var minutes=totalTime-hours*3600;var minutes2=minutes/60;var minFormat=Math.round(minutes2/unit)*unit/100;var minFormatFixed=minFormat.toFixed(2);var minVal=(minFormatFixed+"").split(".");return hours+"."+minVal[1]}$(document).ready(function(){$("#utilities_nav").addClass("ui-toolbar ui-widget-header ui-corner-tl ui-corner-tr");$(".utilities_nav_choices").buttonset();var target=$("div#utilities_panel");$("#reports_button").click(function(){$("#utilities_panel").load("index.php?i=Utilities.php #report_chooser",function(){$('select[name="type"]').chosen();$('input[name="date_start_display"]').datepicker({dateFormat:"DD, MM d, yy",altField:$('input[name = "date_start"]'),altFormat:"yy-mm-dd"});$('input[name="date_start_display"]').datepicker("setDate","-7");$('input[name="date_end_display"]').datepicker({dateFormat:"DD, MM d, yy",altField:$('input[name = "date_end"]'),altFormat:"yy-mm-dd"});$('input[name="date_end_display"]').datepicker("setDate",new Date);$("#report_chooser").after('<table cellpadding="0" cellspacing="0" border="0" '+'class="display" id="table_reports"><tfoot><tr></tr></tfoot></table>');$("button.report_submit").live("click",function(event){event.preventDefault();var tableHeight=$("#utilities_panel").height()-$("#report_chooser").height()-150;if($("#table_reports tfoot th").length){$("#table_reports").dataTable().fnDestroy();$("#table_reports tfoot tr").empty()}if($("thead th").length){$("thead th").remove()}var q_type=$('select[name="type"]').val();var start=$('input[name="date_start"]').val();var end=$('input[name="date_end"]').val();var detail=$('input[name="detail"]').val();var query=[];if(q_type.indexOf("_grp_")!==-1){query.push("grp",q_type)}else if(q_type.indexOf("_spv_")!==-1){query.push("supvsr_grp",q_type)}else if(q_type.indexOf("_cse_")!==-1){query.push("case",q_type)}else{query.push("user",q_type)}$.ajax({url:"lib/php/data/utilities_reports_load.php?type="+query[0]+"&columns_only=true",dataType:"json",type:"get",error:function(){return true},success:function(data){if(data){for(var i=0;i<data.aoColumns.length;i++){$("#table_reports tfoot tr").append("<th></th>")}oTable=$("#table_reports").dataTable({sAjaxSource:"lib/php/data/utilities_reports_load.php?type="+query[0]+"&val="+query[1]+"&date_start="+start+"&date_end="+end,aoColumns:data.aoColumns,bAutoWidth:false,bProcessing:true,bDestroy:true,bScrollInfinite:true,sScrollY:tableHeight,iDisplayLength:150,bSortCellsTop:true,oLanguage:{sEmptyTable:"No data found."},oTableTools:{sSwfPath:"lib/DataTables-1.8.2/extras/TableTools/media/swf/copy_cvs_xls_pdf.swf",aButtons:[{sExtends:"collection",sButtonText:"Print/Export",aButtons:[{sExtends:"copy",mColumns:"visible"},{sExtends:"csv",mColumns:"visible"},{sExtends:"xls",mColumns:"visible"},{sExtends:"pdf",mColumns:"visible",sTitle:"Report",bFooter:"visible"},{sExtends:"print",mColumns:"visible"}]}]},sDom:"frTt",fnInitComplete:function(){$("#table_reports").addClass("print_content");$("#ToolTables_table_reports_5").live("click",function(){var dialogWin=$('<div class="dialog-casenote-delete" title="Print">'+"Please use your browser's print function to print this table."+"Press escape when finished.</div>").dialog({autoOpen:false,resizable:false,modal:true,buttons:{OK:function(){$(this).dialog("destroy")}}});$(dialogWin).dialog("open")})},fnFooterCallback:function(nRow,aaData,iStart,iEnd,aiDisplay){if(aaData.length>0){var totalTime=0;var colIndex=oTable.fnGetColumnIndex("Seconds");var filteredData=oTable.fnGetFilteredData();for(var a=0;a<filteredData.length;a++){totalTime+=parseFloat(filteredData[a][colIndex])}var nCells=nRow.getElementsByTagName("th");var previousCell=colIndex-2;nCells[previousCell].innerHTML="Total Hours";var unit=$("#utilities_panel").attr("data-unit");nCells[colIndex-1].innerHTML=convertToHours(totalTime,unit)}}})}}})})})});$("#config_button").click(function(){target.load("lib/php/data/utilities_configuration_load.php")});$("#non_case_button").click(function(){$("#utilities_panel").html('<div id="noncase_panel"></div>');loadCaseNotes($("#noncase_panel"),"NC")});$("#reports_button").trigger("click")});$("a.config_item_link").live("click",function(event){event.preventDefault();if($(this).hasClass("closed")){$(this).removeClass("closed").addClass("opened")}else{$(this).removeClass("opened").addClass("closed")}$("div.config_item > a").not($(this)).removeClass("opened").addClass("closed");$(this).next().toggle();$("form.config_form").not($(this).next()).hide()});$("a.change_config").live("click",function(event){event.preventDefault();var formTarget=$(this).closest("form");var formParent=$(this).closest("div.config_item");var target=$(this).closest("div").attr("id");if(!$(this).hasClass("add")){$(this).parent().remove()}var formVals=formTarget.serializeArray();formVals.push({name:"type",value:formTarget.attr("data-type")});$.post("lib/php/data/utilities_configuration_process.php",formVals,function(data){var serverResponse=$.parseJSON(data);if(serverResponse.error===true){notify(serverResponse.message,true)}else{notify(serverResponse.message);formParent.load("lib/php/data/utilities_configuration_load.php #"+target,function(){$(this).find("form").show()})}})});
//# sourceMappingURL=utilities.map